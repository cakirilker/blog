{"componentChunkName":"component---src-templates-post-template-js","path":"/testing-react-part-1","result":{"data":{"markdownRemark":{"html":"<p>This post is the first part of the test-driven development with React series. We will be using CRA (Create React App) as application template, Jest, React Testing Library and Cypress as our testing tools in this series. In this part, we will set up our React application, linting and test environment then we will take the first step to develop our first feature with <code class=\"language-text\">Test Driven Development</code> for our \"TODO\" application. Let's get started shall we?</p>\n<p>Before we begin I would like to give some information about the specific TDD approach that we will be practicing in this series.</p>\n<h2>Outside-In TDD</h2>\n<p>TLDR; First, we will use E2E tests to  define the feature we want. Then we will create neccesary components/structures to start writing unit tests. Then we will start to implement component/application logic to make our unit tests green. After all test cases are green we will refactor our code if needed and step back to the <em>outside</em> level. Eventually we will have our feature production ready by following this <em>red-green-refactor</em> cycle with <em>Outside-in TDD</em> approach.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 537px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/54a03f9b6fdddcae5f1e5bd650741af3/b1cde/loop-e2e.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 27.027027027027025%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAiUlEQVQY042QSQqDQBBFy7Y1jsEEMiyy8QKBgAt1Ebz/qfwtT1Dc+OFR1NhVbWbmRS0S7MX2ykUp7uItrsQKbPBbahY9xVf04k9TGJqJivxPdGJkyFYfMYlBNOsGES+kFDliDj9s/xKxHeW4rFjzuZ1TSbNn6wcXOIbt/uiMPN+Qsm049baJLZoBKMUEQnPI++kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Outside-In TDD Loop\"\n        title=\"Outside-In TDD Loop\"\n        src=\"/static/54a03f9b6fdddcae5f1e5bd650741af3/b1cde/loop-e2e.png\"\n        srcset=\"/static/54a03f9b6fdddcae5f1e5bd650741af3/12f09/loop-e2e.png 148w,\n/static/54a03f9b6fdddcae5f1e5bd650741af3/e4a3f/loop-e2e.png 295w,\n/static/54a03f9b6fdddcae5f1e5bd650741af3/b1cde/loop-e2e.png 537w\"\n        sizes=\"(max-width: 537px) 100vw, 537px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Outside-In TDD Loop</p></figcaption>\n  </figure></p>\n<h2>Creating the App</h2>\n<p>First we create our application with following npx command. If you have any trouble running it please check <a href=\"https://github.com/facebook/create-react-app#creating-an-app\">CRA documentation</a>.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ npx create-react-app todo-app</code></pre></div>\n<p>It will start the installation and when it completes we will have our application ready to roll.</p>\n<p>After completion please open package.json file to see what scripts we have available:</p>\n<ul>\n<li><code class=\"language-text\">start</code> to run application, obviously</li>\n<li><code class=\"language-text\">build</code> to create a release build of application</li>\n<li><code class=\"language-text\">test</code> to run unit tests (currently we have only App.test.js)</li>\n<li><code class=\"language-text\">eject</code> to custom setup, it moves every configuration and dependencies into project (leave it for now)</li>\n</ul>\n<p>Go ahead and run the application with start command; you will see spinning React logo on your browser.</p>\n<h2>Setting Up Linting/Formatting</h2>\n<p>I would be very happy (probably you will too) if we add ESLint and formatting configurations before writing a single line of code because it will help us to be consistent. Luckily we already have ESLint installed in CRA app we just need to add some more configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">npx eslint --init</code></pre></div>\n<p>What this will allow us to configure ESLint from CLI and create <code class=\"language-text\">.eslintrc</code> file automatically. So if you run this command you will be prompted with some questions and BOOM! Now you have a config file.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d182f6f5810588630547088335ef5d7/9685e/eslint-answers.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 20.945945945945947%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA90lEQVQY0yWQ6W6CUBBGfSsTVKhdTF1T17IoINu9CBJTce3Dn472x5fZvpzMTGMa7kmrX3x9xs/PhMWVtToRl3fs5Mg4/uFDPIaraTkZxqbA8PJnbawltxWtWUhrKhq4NBbJgXh/JyxvArsR7C7/kt4yPdKzMywxd0cunYGDOfSw+hL7NqYAzL5L+9Oh/eg9gN9hyq6qSfKKUB8EehH4lZmuGfklY0cxlM1W24KZv8OcR3SWEcbExlpusWTeXCQ0xz6vkzUNNwhQKn8qU5o0L0mKmkCf5BV34urGXB1ZiXpyTSeqsDz9hHWdlDc342UV0f3a8D7x+AMWwKXZRHOxMAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"ESLint CLI Answers\"\n        title=\"ESLint CLI Answers\"\n        src=\"/static/4d182f6f5810588630547088335ef5d7/fcda8/eslint-answers.png\"\n        srcset=\"/static/4d182f6f5810588630547088335ef5d7/12f09/eslint-answers.png 148w,\n/static/4d182f6f5810588630547088335ef5d7/e4a3f/eslint-answers.png 295w,\n/static/4d182f6f5810588630547088335ef5d7/fcda8/eslint-answers.png 590w,\n/static/4d182f6f5810588630547088335ef5d7/efc66/eslint-answers.png 885w,\n/static/4d182f6f5810588630547088335ef5d7/c83ae/eslint-answers.png 1180w,\n/static/4d182f6f5810588630547088335ef5d7/9685e/eslint-answers.png 1336w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>ESLint CLI Answers</p></figcaption>\n  </figure></p>\n<p>Still, we need to add plugins of Cypress, Jest and Prettier for ESLint, to do that please install the following packages.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">$ <span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --dev eslint-config-prettier <span class=\"token punctuation\">\\</span>\n                 eslint-plugin-cypress <span class=\"token punctuation\">\\</span>\n                 eslint-plugin-jest <span class=\"token punctuation\">\\</span>\n                 eslint-plugin-prettier <span class=\"token punctuation\">\\</span>\n                 prettier</code></pre></div>\n<p>Now, we need to tweak configuration files for Cypress, Jest and Prettier plugins.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  env<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    browser<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    es2020<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'cypress/globals'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'jest/globals'</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token keyword\">extends</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token string\">'plugin:react/recommended'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'airbnb'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'prettier'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'plugin:jest/recommended'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token string\">'plugin:cypress/recommended'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  parserOptions<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    ecmaFeatures<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      jsx<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    ecmaVersion<span class=\"token operator\">:</span> <span class=\"token number\">11</span><span class=\"token punctuation\">,</span>\n    sourceType<span class=\"token operator\">:</span> <span class=\"token string\">'module'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  settings<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    react<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      version<span class=\"token operator\">:</span> <span class=\"token string\">'detect'</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  plugins<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">'react'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'prettier'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'jest'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'cypress'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  rules<span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token string\">'prettier/prettier'</span><span class=\"token operator\">:</span> <span class=\"token string\">'warn'</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With this configuration setup we have:</p>\n<ul>\n<li>Set up linting with additional airbnb, Jest, Cypress and Prettier rules.</li>\n<li>Configure ESLint to aware of globals provided by Cypress and Jest</li>\n</ul>\n<p>And last, Prettier configuration; create <code class=\"language-text\">.prettierrc.js</code> file and paste the following content. I haven't added too much config for prettier but you can check <a href=\"https://prettier.io/docs/en/options.html\">the documentation</a> and adjust it more.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">module<span class=\"token punctuation\">.</span>exports <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token string\">\"tabWidth\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"useTabs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"arrowParens\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"avoid\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"bracketSpacing\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"singleQuote\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n  <span class=\"token string\">\"trailingComma\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"all\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Setting up E2E Testing - Cypress</h2>\n<p>Now we have configured linting/formatting it's time to add our E2E testing tool - Cypress.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --dev cypress</code></pre></div>\n<p>After installing, add a script to <code class=\"language-text\">package.json</code> file. </p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\">{\n<span class=\"token unchanged\">  \"start\": \"react-scripts start\",\n  \"build\": \"react-scripts build\",\n  \"test\": \"react-scripts test\",\n</span><span class=\"token inserted-sign inserted\">+ \"cypress\": \"cypress open\",  \n</span><span class=\"token unchanged\">  \"eject\": \"react-scripts eject\"\n</span>}</code></pre></div>\n<p>If we run <code class=\"language-text\">yarn cypress</code> a Cypress window will open and tell you it has run succesfully and created bunch of example tests. Now you can click any of these to see how Cypress works; if you do a new browser window will open and run the selected spec.</p>\n<p>Time to tweak some configuration. In your workspace there is a new file called <code class=\"language-text\">cypress.json</code> which just generated by Cypress and used for its configuration. Open it and add URL of our application. </p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://localhost:3000\"</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>From now on all relative URLs will be interpreted to the root of our app. If you like you could delete <code class=\"language-text\">cypress/integrations/examples</code> directory since we don't need those then create a file <code class=\"language-text\">cypress/integration/smoke.spec.js</code> and add our first E2E test.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Smoke Test'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'can view the default react page'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Learn React'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>With this test our only intention is to verify that our application is accessible and working properly with Cypress tests. If you go back to Cypress window (re-run <code class=\"language-text\">yarn cypress</code> if you closed it) and you should see updated spec list with only one test. Click it and you will see our React application beside successful test runs.</p>\n<p><figure class=\"gatsby-resp-image-figure\" style=\"\">\n    <span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d12d27ee38c7969da1e475243433cbfc/ae28e/initial-cypress-test.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 58.10810810810811%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAAAsUlEQVQoz62Q2wqDMBBE8/+/57NWU0OjuRiLNgE10xhLKxTaUjNw2MnDLjMhWZahLEsURQHOOfI8R1VVEEKgbduPCCHBLzUoPYExFvcJpRRKKRhj0Pd99Frr6L9xDUilQWuOM2uguw6E8wYrUsp4zDkXsdb+zHjbsNaBaDNCdgOG0WGeZyzLAu/93xAEhXlI/sEq8rL+ULJnwv1jS+tTVD7Yeaf0B1P821vllCLTNCEld2t7rcMzO79vAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Cypress Smoke Test\"\n        title=\"Cypress Smoke Test\"\n        src=\"/static/d12d27ee38c7969da1e475243433cbfc/fcda8/initial-cypress-test.png\"\n        srcset=\"/static/d12d27ee38c7969da1e475243433cbfc/12f09/initial-cypress-test.png 148w,\n/static/d12d27ee38c7969da1e475243433cbfc/e4a3f/initial-cypress-test.png 295w,\n/static/d12d27ee38c7969da1e475243433cbfc/fcda8/initial-cypress-test.png 590w,\n/static/d12d27ee38c7969da1e475243433cbfc/efc66/initial-cypress-test.png 885w,\n/static/d12d27ee38c7969da1e475243433cbfc/c83ae/initial-cypress-test.png 1180w,\n/static/d12d27ee38c7969da1e475243433cbfc/ae28e/initial-cypress-test.png 1598w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span>\n    <figcaption class=\"gatsby-resp-image-figcaption\"><p>Cypress Smoke Test</p></figcaption>\n  </figure></p>\n<h2>Cleanup</h2>\n<p>Before we get to developing listing todos feature, let's clean up the project a little bit. Delete the following files</p>\n<ul>\n<li>App.css</li>\n<li>App.test.js</li>\n<li>logo.svg</li>\n<li>serviceWorker.js</li>\n<li>smoke.spec.js</li>\n</ul>\n<p>Replace content of App.js</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">App</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>Hello World<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> App<span class=\"token punctuation\">;</span></code></pre></div>\n<p>index.js</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\">  import React from 'react';\n  import ReactDOM from 'react-dom';\n</span><span class=\"token deleted-sign deleted\">- import './index.css';\n</span><span class=\"token unchanged\">  import App from './App';\n</span><span class=\"token deleted-sign deleted\">- import * as serviceWorker from './serviceWorker';\n</span>\n<span class=\"token unchanged\">  ReactDOM.render(\n    &lt;React.StrictMode>\n      &lt;App />\n    &lt;/React.StrictMode>,\n    document.getElementById('root')\n  );\n</span>\n<span class=\"token deleted-sign deleted\">- // If you want your app to work offline and load faster, you can change\n- // unregister() to register() below. Note this comes with some pitfalls.\n- // Learn more about service workers: https://bit.ly/CRA-PWA\n- serviceWorker.unregister();</span></code></pre></div>\n<h2>Listing Todos</h2>\n<p>Let's start by displaying todos as a list on screen. That would be very cool if we had a backend API for that. In fact we do have an API, we will use <a href=\"https://mockapi.io/\">mockapi.io</a> and I've already configured a project so you don't need to do that. However if you like you could create your own project and use that one in the exercise.</p>\n<p>We will use <a href=\"https://5f0c1de19d1e150016b37d04.mockapi.io/todos\">https://5f0c1de19d1e150016b37d04.mockapi.io/todos</a> endpoint to fetch availlable todos. So let's create a component and implement it to display data from API, right?</p>\n<p>A big no. Since we are practicing test-driven development we must allow tests to drive our code. We will start from outside, in our case it's writing E2E test first and watching it fail.</p>\n<p>Create <code class=\"language-text\">listing-todos.spec.js</code> with following content in <code class=\"language-text\">cypress/integration</code> directory.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'listing todos'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'shows todos from api'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> firstTodo <span class=\"token operator\">=</span> <span class=\"token string\">'First Todo'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> secondTodo <span class=\"token operator\">=</span> <span class=\"token string\">'Second Todo'</span><span class=\"token punctuation\">;</span>\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">server</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> force404<span class=\"token operator\">:</span> <span class=\"token boolean\">true</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">route</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n      method<span class=\"token operator\">:</span> <span class=\"token string\">'GET'</span><span class=\"token punctuation\">,</span>\n      url<span class=\"token operator\">:</span> <span class=\"token string\">'https://5f0c1de19d1e150016b37d04.mockapi.io/todos'</span><span class=\"token punctuation\">,</span>\n      response<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> firstTodo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> secondTodo <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">visit</span><span class=\"token punctuation\">(</span><span class=\"token string\">'/'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>firstTodo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    cy<span class=\"token punctuation\">.</span><span class=\"token function\">contains</span><span class=\"token punctuation\">(</span>secondTodo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here is what we have done:</p>\n<ul>\n<li>Fist we created todo variables which we will use to mock GET response and later check if they are in document with Cypress.</li>\n<li>Then we setup Cypress server with <code class=\"language-text\">{ force404: true }</code> option. With that option Cypress will return <code class=\"language-text\">404 Not Found</code> status for not stubbed requests with <code class=\"language-text\">cy.route</code>. <a href=\"https://docs.cypress.io/api/commands/server.html#Send-404s-on-unmatched-requests\">See more</a> about it.</li>\n<li>Then we call <code class=\"language-text\">cy.route</code> to stub GET request that we gonna call and whenever we send request we will get specified response.</li>\n<li>Call Cypress to navigate root path of the application. Then we expect to see todo values in document with <code class=\"language-text\">cy.contains</code>.</li>\n</ul>\n<p>Go ahead, run <code class=\"language-text\">yarn cypress</code> and click <code class=\"language-text\">listing-todos.spec.js</code> test and watch it fail. It has failed because we told Cypress to expect <code class=\"language-text\">First Todo</code> in page content but it couldn't find.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5ef264949024731cf07f55efb9981ae/dc333/cypress-fail.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 111.48648648648648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAAC/0lEQVQ4y51ViXLjNgzN//9bp2l3k3h9yXFiW/dBSqJIiXx9kBI3ySaz7XLmGRAk4gZ8k+8iHM4ZDscY0fGC57hEXrXISo0k10gLRV7NfFUrKPU1tNa4sXc/eCHHIdohIqqyAIKHn8aZ8ueKEL6G9x7TNOHGPWwQJo+2bWGMuVqr6wbOOciZL+HzI+/kdF2Hqqro4WoD8aOjQhGI22Ltquh/4qpw6PtZqaZ3nq7/7pkVSmC17nBKMiRlDW0s6raHIlWDXWg//BJ2ZA7tegenW3T7I8r7H6jvVjDPF7T7R2ga08xxu97DnOJZ/hE9Yc8J8m2E/BKLwj2mRmGiIoH76zvG+xX8ZocQHeGpWChOF+D5TLzSV56gMRs9wmQ5FW72GKsa9s+/Yb/dw95+w/DHLdzdAwIth3O8gBff4fRCn87wYux4AqpmCXlUGiMt2H2E8XQmLnB8docj3OMThvWW7w5wx+f5WeSWEYzkpySF4z2fFwjM96KQOXSrNaY1K77bYtqQbtYzcGFoVbmgroGGYHuh5HNJynQFoexbDMOicJKipCmyXCHNemRZizjtyC/Iih4J5WlOnsgLQY+enWHZakPbYWD/BvOqkCEbWsyVQVI7ZI1FXDmkM79A5GltkRE53xfKomeI1loMAnoXXj0c6TasQ+D4wPWfDdh/62pr/y3KxAlpkwSGuRpHNy+JU1IiOheImfAsy6Cahmms0DK80Vk4KhgF5Md3HkqVmfCh1cwFl8Jg0HctFGV1o2do1cyoaVBTsbPD/N0Vpv8QMvMxdj38sIQsOdGdQakHjiFHi4VTWpSrmXoffs7KNeQXhSbN6S09YS47LgvP7THJnnvZdW/5d1tG9FEe3uYQvYFn2T09E+9e9tfX+FgvkbGwVw+nmB3P5I+CrICjt6GQBq7ZuG+xyMwlwcA78q3ccZyYwH68NraMW7Hbo9juiD1yjpbl9kBeIvASZLQEM1+ijg4o+X3DMSz5v5Rw0sSxG7faLi5P/rP9vqz4DwghfPV/gH8ApcWdyw/Z7wsAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cypress fail\"\n        title=\"cypress fail\"\n        src=\"/static/c5ef264949024731cf07f55efb9981ae/fcda8/cypress-fail.png\"\n        srcset=\"/static/c5ef264949024731cf07f55efb9981ae/12f09/cypress-fail.png 148w,\n/static/c5ef264949024731cf07f55efb9981ae/e4a3f/cypress-fail.png 295w,\n/static/c5ef264949024731cf07f55efb9981ae/fcda8/cypress-fail.png 590w,\n/static/c5ef264949024731cf07f55efb9981ae/efc66/cypress-fail.png 885w,\n/static/c5ef264949024731cf07f55efb9981ae/dc333/cypress-fail.png 938w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now it's time to write some code to make it green. But before we do let's think about the structure of code a moment. We know that we need to display some todo items on screen, so we would need:</p>\n<ul>\n<li>Component to display todo items</li>\n<li>An API client to fetch data</li>\n<li>A structure to store and manage fetched data</li>\n</ul>\n<p>Since we practice outside-in testing, we should first build outside which corresponds to interface components in this example. Currently we only have <code class=\"language-text\">&lt;App/&gt;</code> component; we could write all displaying logic in <code class=\"language-text\">&lt;App/&gt;</code> component but it's better if we do not bloat <code class=\"language-text\">&lt;App/&gt;</code> component with that logic and create a seperate component.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\">  import React from 'react';\n</span><span class=\"token inserted-sign inserted\">+ import { TodoContainer } from './containers';\n</span>\n\n<span class=\"token unchanged\">  const App = () => {\n    return (\n      &lt;div>\n</span><span class=\"token deleted-sign deleted\">-     Hello World!\n</span><span class=\"token inserted-sign inserted\">+     &lt;TodoContainer />\n</span><span class=\"token unchanged\">      &lt;/div>\n    );\n  };</span></code></pre></div>\n<p>Then create <code class=\"language-text\">containers</code> directory then inside create a <code class=\"language-text\">TodoContainer.js</code> component.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TodoContainer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>\n      Todos\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoContainer<span class=\"token punctuation\">;</span></code></pre></div>\n<p>You might have realized that we have imported TodoContainer like this <code class=\"language-text\">{ TodoContainer }</code> in <code class=\"language-text\">&lt;App/&gt;</code> component. It's because we will use Barrel export. But what is barrel export is?</p>\n<blockquote>\n<p>A barrel is a way to rollup exports from several modules into a single convenient module. The barrel itself is a module file that re-exports selected exports of other modules.</p>\n<p>Source: <a href=\"https://basarat.gitbook.io/typescript/main-1/barrel\">Barasat Gitbook</a></p>\n</blockquote>\n<p>I am using VS Code as text editor and I have an awesome extension recommendation for this job, <a href=\"https://marketplace.visualstudio.com/items?itemName=mikehanson.auto-barrel\">Auto Barrel</a>. It allows you to create barrel files automatically with one-click.</p>\n<p>If you want to do it manually create an <code class=\"language-text\">index.js</code> file inside <code class=\"language-text\">containers</code> folder and paste following content.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">export</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">default</span> <span class=\"token keyword\">as</span> TodoContainer <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./TodoContainer'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Even though we did bunch of work if we re-run E2E test we will see that we are not even close to passing the test. Since we are developing a todo application we will also have adding todo feature and that's different responsibility from listing. Thus it might be perfect time to create <code class=\"language-text\">&lt;TodoList/&gt;</code> component.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\">  import React from 'react'\n</span><span class=\"token inserted-sign inserted\">+ import { TodoList } from '../components';\n</span>\n<span class=\"token unchanged\">  const TodoContainer = () => {\n    return (\n      &lt;div>\n</span><span class=\"token deleted-sign deleted\">-       Todos\n</span><span class=\"token inserted-sign inserted\">+       &lt;TodoList/>\n</span><span class=\"token unchanged\">      &lt;/div>\n    )\n  }\n  \n  export default TodoContainer</span></code></pre></div>\n<p>Create a <code class=\"language-text\">components</code> folder and inside create <code class=\"language-text\">TodoList.js</code> component.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TodoList</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div<span class=\"token operator\">></span>TodoList<span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoList<span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Writing a Unit Test</h2>\n<p>Now that we have the components that we need for now, it's time to step \"inside\"; to the unit test level. We have already specified feature behavior in \"outside\" level with E2E test and now, we will narrow down specifying behavior of component with unit tests.</p>\n<p>To start with unit tests, let's create a <code class=\"language-text\">__tests__</code> folder inside <code class=\"language-text\">src</code> directory, then inside create a <code class=\"language-text\">TodoList.spec.js</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Todo List'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  it<span class=\"token punctuation\">.</span><span class=\"token function\">todo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should load todos on first render'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  it<span class=\"token punctuation\">.</span><span class=\"token function\">todo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should display todo items'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Go ahead and run <code class=\"language-text\">yarn test</code> and you will see following:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cfa95d85450ed855f94d05d918157b9f/5bf79/test-todo.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 29.72972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA60lEQVQY042QzY6CMBSFfQ4cRQGh/DitiAJDAR0mM0Y0YWHi3oU7fQOf/dg2OjEmRBcn9+Y258s57ZwuB5wvR4RxBSfIYPtfMJw56HSJhK/BZhWmya+a8l0bMHwMJ+je5rM6XT2EFyyE4RsBK0GEiQQcji/hKSw3gUVijLwUhj0HGXP0zbAdqFsRTDuGzwqVgHymcFkKj3IF8WmhoLbYH42twL96j7JqEIlajqjLyxqrzQ7jKBf7FnG2gqZTJQm5qw2qgIufBq6oIg9ZvgUvGvSMEDL9I+CthDKBR/P/WvIvabRUBk1nLwHPugIHf7cbO4FmZwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test todo\"\n        title=\"test todo\"\n        src=\"/static/cfa95d85450ed855f94d05d918157b9f/fcda8/test-todo.png\"\n        srcset=\"/static/cfa95d85450ed855f94d05d918157b9f/12f09/test-todo.png 148w,\n/static/cfa95d85450ed855f94d05d918157b9f/e4a3f/test-todo.png 295w,\n/static/cfa95d85450ed855f94d05d918157b9f/fcda8/test-todo.png 590w,\n/static/cfa95d85450ed855f94d05d918157b9f/efc66/test-todo.png 885w,\n/static/cfa95d85450ed855f94d05d918157b9f/5bf79/test-todo.png 966w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Note that we have described tests as todo and they are highlighted with purple color on the console. This is because we have used <code class=\"language-text\">it.todo</code> method of Jest. I really like to describe tests like this instead of using an empty callback function. We don't usually write our tests all together but if we do, we could prepare a \"todo list\" for tests with this approach.</p>\n<p>As our first test tells us we expect to fetch todos on render so we could expect component to have a <code class=\"language-text\">loadTodos</code> function. For now we do not care where this function comes from, it might come from connected Redux component or from the parent. This is just implementation detail and we don't need to think about it while writing our test.\nYet we need to mock this function in our component so let's do it with Jest.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Todo List'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should load todos on first render'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> loadTodos <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loadTodos'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then we need to render the component. We use <code class=\"language-text\">render</code> function of React Testing Library in order to do that. Also as prop we pass mocked <code class=\"language-text\">loadTodos</code> function. we add an expectation to check if mocked function was called. If mocked function was called that means that our component loads todos.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token inserted-sign inserted\">+  import React from 'react';\n+  import { render } from '@testing-library/react';\n+  import { TodoList } from '../components';\n</span><span class=\"token unchanged\">  \n  describe('Todo List', () => {\n    it('should load todos on first render', () => {\n      const loadTodos = jest.fn().mockName('loadTodos');\n</span><span class=\"token inserted-sign inserted\">+     render(&lt;TodoList loadTodos={loadTodos} />);\n+     expect(loadTodos).toHaveBeenCalled();\n</span><span class=\"token unchanged\">    });\n    it.todo('should display todo items');\n  });</span></code></pre></div>\n<p>Re-run tests and watch it fail. </p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c2d41fd58b6acc732481d69a80ccefb8/5bf79/test-failed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 76.35135135135135%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAACq0lEQVQ4y21Ua3OaUBDlV3SixgcgD0EEeQgICibaGk0mSdM002mm/6X946dnb5Kp0/HD3t297D37OPei/b7/gT/Pv7AodpjMVvAo40mBpPiM5voBeXWDcnXEYrlX37rDEH0jxqU+R28UKX0qWoeLG6wQ5zv4UUO7fgMOVzCcHLa/hMkE4uvOApZXKr9D4A/QU2BNNxO4dg6fBycMdqj96RLBrIZHX/ZFPO4ZjJV4y0qVfbZC186QMjj2S0TM7DK4nFbKXhBUpGR1Af1YgFllRh3S754DlM0hQYcMtKkTBga0pa0gvcKco5gmV8p2OQpp9YLSOQOmAGVJScByfUSUXaNu7xAvtvDDNTLuT6M1bIKbTqoIuZSZDSNlS8tdsQeh0uJrssySDdJSDjfI6wPCxU4RlZZ7EtVCHydwWLUkH5BhnZ0IYQOZKROZE/FTxb72kUV3lvjU82GFDarjK6rmgK8Pj7jZ3yLJVtjePGN//I72+g7bL0+4fXhlVwcsGxaxbuHHJM1OofWZ1WAFhlOoki22l/JOTqMVsrxREkQkh+1LF3OOJYhbhDJTkjkwOLvRHBf98F/LUrrlr5V2yfZFP0CHc7noR0q6AxIwjNQh2VfyPsPe/6TI5nCcwQlateGHtarCi3h1ipqtlJxpRV1gShE/SEtMgpzkkIzB7E0P34jRuu83fmRlGLsFDDdntUs4bMf2cxheAWfewCbbLq+PyTvqCWnxhvYK5qyB4VcwedbkWU2AhLUJL7DDYEtsfnD4SuSZ2UGFkctZcca6V9MuYUzX0P2aQDXMgLZXEWOhcLTj/U9s99/U45dn18YNXuo9MgIl2QHt+onsZZiThDETdTjfHtvsnspHy0LK/viC9dW9qk7u0Wb3qP4y4ocxX8h8o6qX7PK9d+Z1nMpfI23OHKX6RlYAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test failed\"\n        title=\"test failed\"\n        src=\"/static/c2d41fd58b6acc732481d69a80ccefb8/fcda8/test-failed.png\"\n        srcset=\"/static/c2d41fd58b6acc732481d69a80ccefb8/12f09/test-failed.png 148w,\n/static/c2d41fd58b6acc732481d69a80ccefb8/e4a3f/test-failed.png 295w,\n/static/c2d41fd58b6acc732481d69a80ccefb8/fcda8/test-failed.png 590w,\n/static/c2d41fd58b6acc732481d69a80ccefb8/efc66/test-failed.png 885w,\n/static/c2d41fd58b6acc732481d69a80ccefb8/5bf79/test-failed.png 966w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>What test tells us is that it expected to function to have been called at least one time but it didn't. That's normal because we haven't did anyting in our component about <code class=\"language-text\">loadTodos</code> function. Let's make it green.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\">  import React, { useEffect } from 'react';\n  \n  const TodoList = ({ loadTodos }) => {\n</span><span class=\"token inserted-sign inserted\">+   useEffect(() => {\n+     loadTodos();\n+   }, []);\n</span><span class=\"token unchanged\">    return &lt;div>TodoList&lt;/div>;\n  };\n  \n  export default TodoList;</span></code></pre></div>\n<p>Save the file and you will see that we've passed the unit test! Now, let's write a test for the second behavior: Displaying todo items. Add following <code class=\"language-text\">it()</code> block inside the <code class=\"language-text\">describe()</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should display todo items'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">noop</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> todos <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'First Todo'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'Second Todo'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> queryByText <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>TodoList loadTodos<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>noop<span class=\"token punctuation\">}</span> todos<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>todos<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">queryByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'First Todo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">queryByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Second Todo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here is what we have just done:</p>\n<ul>\n<li>Since we aren't going to run any expectation for <code class=\"language-text\">loadTodos</code> we created <code class=\"language-text\">noop</code> function that does nothing.</li>\n<li>We define an array of <code class=\"language-text\">todos</code>.</li>\n<li>\n<p>We render the component and destructure the <code class=\"language-text\">queryByText</code> property which we will use in expectation.</p>\n<ul>\n<li><code class=\"language-text\">queryByText</code> will search all elements text node with given text. If it matches any node, it returns element; if it doesn't, it returns null. Here is <a href=\"https://testing-library.com/docs/dom-testing-library/api-queries#bytext\">documentation</a>.</li>\n</ul>\n</li>\n<li>Then we use <code class=\"language-text\">queryByText</code> function to check render result and we expect to have <em>not</em> null as result to confirm we have our list.</li>\n</ul>\n<p>Let's save file and run, it's failed as we expect.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/e4ff31291a182ce6df45a57526690bdc/0c3d0/test-listing-failed.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABSElEQVQoz31RWXLCMBTLMVpo9n1x4jgJSxKgwEz/e4ne/waq7DAMU9p+aCR7PLKenvX18YmiPiDMtgZCvaNqT6jkCUVzhM87O1BYexJvfmvwqH/CqpsD5HBFTlNtkJFTMSNvFvbiAV7U300e+Tdjq0gGlOkGSdyjYpom30EWe5RaFzvENFv9k+jJMC9H1EzWkqWgkZggmE6oEaXcw+dHQbqFGw2mEld/4DbPuCW2Ip2GfSXlhKxll/kGfkIwtR0qM3KQ9AgTrTuab3geljdkfdbai7oloRN2vNhhzeJDcURK46a7mKVE2cBemVZOkHKLQoyo1BllMyNjv2k1caGLThjEDmioC9eGehzZn1F3Z/LVbLpQTN/tkcsRWTWj7S/I1BUuU7/Ywoz66ixYubeRnbBHXMxMpDfam44W7gh1hxOq211v9F9L+QYysu+oVyUsLAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test listing failed\"\n        title=\"test listing failed\"\n        src=\"/static/e4ff31291a182ce6df45a57526690bdc/fcda8/test-listing-failed.png\"\n        srcset=\"/static/e4ff31291a182ce6df45a57526690bdc/12f09/test-listing-failed.png 148w,\n/static/e4ff31291a182ce6df45a57526690bdc/e4a3f/test-listing-failed.png 295w,\n/static/e4ff31291a182ce6df45a57526690bdc/fcda8/test-listing-failed.png 590w,\n/static/e4ff31291a182ce6df45a57526690bdc/efc66/test-listing-failed.png 885w,\n/static/e4ff31291a182ce6df45a57526690bdc/c83ae/test-listing-failed.png 1180w,\n/static/e4ff31291a182ce6df45a57526690bdc/0c3d0/test-listing-failed.png 1414w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>We received <em>null</em> which means that none of elements have text node with the \"First Todo\". Now, time to modify our component to pass the test.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token deleted-sign deleted\">- const TodoList = ({ loadTodos }) => {\n</span><span class=\"token inserted-sign inserted\">+ const TodoList = ({ loadTodos, todos }) => {\n</span><span class=\"token unchanged\">    useEffect(() => {\n      loadTodos();\n    }, []);\n</span><span class=\"token deleted-sign deleted\">-   return &lt;div>TodoList&lt;/div>;\n</span><span class=\"token inserted-sign inserted\">+   return (\n+     &lt;ul>\n+       {todos.map(todo => (\n+         &lt;li key={todo.id}>{todo.name}&lt;/li>\n+       ))}\n+     &lt;/ul>\n+   );\n</span><span class=\"token unchanged\">  };</span></code></pre></div>\n<p>We have added <code class=\"language-text\">todos</code> prop so we could list them with <code class=\"language-text\">map()</code> function. Let's save and watch our tests again.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/2e694/test-failed-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABaUlEQVQoz3VS2XLCMAzMX3QKhCQ4NAdxDjsBcgABZjrTF577Nf317TocQ4E+yJIPrVYrW6flET+nb6hsAzdYQtC8jwpJvkNRHbHIt5DFDonq4YYrTGYKYzfHxCtu/t4s4ZfY1p+ouy9kBAhlhzDtEBPIxMZH6QZJ0Q+F5nGN8R3YI6j17uTwhEK8qGkNoqRFRgATG0u4N3cJi8x8DZ+gQmiMnOwlqGVzqWQLxcSciYJJKyan0RolzzStILDkPiU782ZN1obtVKhnhqaSR21MuwFbDCTZqf0Qh2Qq9X7wZ+sgCLygnll5gM/Y5P8BNBVsT/GypeAaMR/Kao/pg/hXm1z8vy2bjUdNRFjDJqA3LyDzFsGgZ8MhNJx8CYftjaj3+zS9gN0P5gVDETVwOPE3O4MfLpHmDYqy59c5IDUt6t3ZswNzLmU1FHnScABke4HsYYsS80Bju+kJrim6vvlr7M7L89msePltfgFKkw6cJjw4sAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"test failed 2\"\n        title=\"test failed 2\"\n        src=\"/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/fcda8/test-failed-2.png\"\n        srcset=\"/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/12f09/test-failed-2.png 148w,\n/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/e4a3f/test-failed-2.png 295w,\n/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/fcda8/test-failed-2.png 590w,\n/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/efc66/test-failed-2.png 885w,\n/static/c9208a5dd5dc0cd9c30ae69e387ad4e9/2e694/test-failed-2.png 1048w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Now we see that second test passed, but first one failed. It's because we didn't provide <code class=\"language-text\">todos</code> prop in first test. Let's fix that.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"> it('should load todos on first render', () => {\n   const loadTodos = jest.fn().mockName('loadTodos');\n</span><span class=\"token inserted-sign inserted\">+  const todos = [];\n</span>\n<span class=\"token deleted-sign deleted\">-  render(&lt;TodoList loadTodos={loadTodos} />);\n</span><span class=\"token inserted-sign inserted\">+  render(&lt;TodoList loadTodos={loadTodos} todos={todos} />);\n</span><span class=\"token unchanged\">   expect(loadTodos).toHaveBeenCalled();\n });</span></code></pre></div>\n<p>Successfully all tests are green! Now we now <code class=\"language-text\">TodoList</code> component has all behavior we need. In the TDD cycle, <strong>when we get green light for the tests we should look for refactoring opportunities</strong>; both in production and test code. We will clean up some duplication in our test code but since we don't have much production code we will leave it for now. </p>\n<p>In both of our tests, we use some todo mock data, a mocked function and rendered <code class=\"language-text\">TodoList</code> component. We could move this code into <code class=\"language-text\">describe()</code> scope and wrap it with <code class=\"language-text\">beforeEach()</code> function of Jest. After refactoring our tests should look like following:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Todo List'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">let</span> loadTodos<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">let</span> context<span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> todos <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span>\n    <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'First Todo'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">{</span> id<span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> name<span class=\"token operator\">:</span> <span class=\"token string\">'Second Todo'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    loadTodos <span class=\"token operator\">=</span> jest<span class=\"token punctuation\">.</span><span class=\"token function\">fn</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">mockName</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loadTodos'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    context <span class=\"token operator\">=</span> <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&lt;</span>TodoList loadTodos<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>loadTodos<span class=\"token punctuation\">}</span> todos<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>todos<span class=\"token punctuation\">}</span> <span class=\"token operator\">/</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should load todos on first render'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span>loadTodos<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toHaveBeenCalled</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">it</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should display todo items'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> queryByText <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> context<span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">queryByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'First Todo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">expect</span><span class=\"token punctuation\">(</span><span class=\"token function\">queryByText</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Second Todo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>not<span class=\"token punctuation\">.</span><span class=\"token function\">toBe</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>So what we have just done:</p>\n<ul>\n<li>Moved description of mock data and function into <code class=\"language-text\">describe()</code> scope. Also defined a new variable <code class=\"language-text\">context</code>; which used to store result of <code class=\"language-text\">render()</code>.</li>\n<li>Then in <code class=\"language-text\">beforeEach()</code> we assigned loadTodos and context. Whatever is inside <code class=\"language-text\">beforeEach()</code> will run before each test so even though we used the same variables for both tests, they will be isolated from each other.</li>\n</ul>\n<p>Save the file and tests should pass. Now our tests are much cleaner and we can clearly see what we are aiming for in each test.</p>\n<h2>Back to Outside Level</h2>\n<p>In unit test, we defined every behavior that we need for our component and got green light. Now it's time to step outside E2E tests and see what we need to do. Rerun <code class=\"language-text\">yarn cypress</code> and check the output.</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">Cannot read property <span class=\"token string\">'map'</span> <span class=\"token keyword\">of</span> <span class=\"token keyword\">undefined</span></code></pre></div>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/cd00ea6276e603d70d1fced38ec74500/97a96/cypress-fail-2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 45.27027027027027%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAABgUlEQVQoz21S2XarMBDj/7+wy22zQQLY7AnB40XVmKZPl4OYMbaFJFO0xsL0IzrTwdoeOp6mAX3XwDQtpoG9MRj7Huv9jnVZsD4ee9UxsQwjRq4biKIta1TtiH7eMCwOj9VBxGHmQlNWiK2F3JoMV15Z61wzruyrGwIJkRLvhMK1BtM8IYhgv1J+btuGzlqk5Q7PDX7kmmnOSCHsK2NkH/G6MqFcKrjvI2JjkGhbAUIV2dMZoW4hnFMiJVXyMC8ItJ3rfa86px8q5HSBvH/Cfx3gSSz/vpHUIq3a8wW+qklIUmYbxl3hS3Gu/YBAF1mtKvTMQLhRDicIFcmBahmDcIO9lPC/OekH4mNFXJ9Ux/rc9nHun4iMSEkLz3C9bjye4VUR+3AusdVNJgy067t+t6YZqjLNU22q/d9cs0rmmTOU4wk+59VAFcfrLRMaEgrHG+F4ukqqijL5q5I4bu7vYPZDefvIOWp+nr9Ksl3O7EbClWpEidSSeCT/H/B9dI5V8AOpibJDJ9PMHQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"cypress fail 2\"\n        title=\"cypress fail 2\"\n        src=\"/static/cd00ea6276e603d70d1fced38ec74500/fcda8/cypress-fail-2.png\"\n        srcset=\"/static/cd00ea6276e603d70d1fced38ec74500/12f09/cypress-fail-2.png 148w,\n/static/cd00ea6276e603d70d1fced38ec74500/e4a3f/cypress-fail-2.png 295w,\n/static/cd00ea6276e603d70d1fced38ec74500/fcda8/cypress-fail-2.png 590w,\n/static/cd00ea6276e603d70d1fced38ec74500/efc66/cypress-fail-2.png 885w,\n/static/cd00ea6276e603d70d1fced38ec74500/c83ae/cypress-fail-2.png 1180w,\n/static/cd00ea6276e603d70d1fced38ec74500/97a96/cypress-fail-2.png 2400w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Why did we get this error? Didn't we write the necessary logic in our component? Yes, we did but we never actually implement the logic to pass todos into our component. These are just implementation details, no matter what method we use to do that, our component will not care about the implementation. Of course, as long as the tests remain green. </p>\n<p>With unit tests we designed our components behavior and now we could use any implementation to pass this E2E error. We could use Redux, React Context API or something else for this, and in this post I will use Context API with useReducer hook with a similar approach to Redux.</p>\n<p>In order to fix that let's start by creating Context API. Create <code class=\"language-text\">contexts</code> folder and within this create a <code class=\"language-text\">TodoContext.js</code> file and put the following content</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">import</span> React <span class=\"token keyword\">from</span> <span class=\"token string\">'react'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> TodosInitialState <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  todos<span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">const</span> TodoContext <span class=\"token operator\">=</span> React<span class=\"token punctuation\">.</span><span class=\"token function\">createContext</span><span class=\"token punctuation\">(</span>TodosInitialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nTodoContext<span class=\"token punctuation\">.</span>displayName <span class=\"token operator\">=</span> <span class=\"token string\">'TodoContext'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TodoProvider</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> children <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">,</span> dispatch<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useReducer</span><span class=\"token punctuation\">(</span>TodosReducer<span class=\"token punctuation\">,</span> TodosInitialState<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> <span class=\"token function-variable function\">loadTodos</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>TodoContext<span class=\"token punctuation\">.</span>Provider\n      value<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span>\n        <span class=\"token operator\">...</span>state<span class=\"token punctuation\">,</span>\n        loadTodos<span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">></span>\n      <span class=\"token punctuation\">{</span>children<span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>TodoContext<span class=\"token punctuation\">.</span>Provider<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodoProvider<span class=\"token punctuation\">;</span></code></pre></div>\n<p>What we have done is:</p>\n<ul>\n<li>Created a TodoContext object with <code class=\"language-text\">createContext()</code> method of React.We used <code class=\"language-text\">TodosInitialState</code> as initial value which we will also use in reducer.</li>\n<li>Then we assigned it's <code class=\"language-text\">displayName</code> value with something meaningful. This will help us to find <code class=\"language-text\">TodoContext</code> in DevTools.</li>\n<li>We added <code class=\"language-text\">useReducer</code> hook with <code class=\"language-text\">TodosReducer</code> object. This will be used as our store that we provide into Context. Don't worry about reducer itself, we will create it in a minute.</li>\n<li>Added an empty <code class=\"language-text\">loadTodos</code> function.</li>\n<li>We created a small component that wraps child components with TodoContext. Note that we passed <code class=\"language-text\">loadTodos</code> function and state object as value to Context.</li>\n</ul>\n<p>Now, add <code class=\"language-text\">TodoProvider</code> into <code class=\"language-text\">&lt;App&gt;</code> component.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"> const App = () => {\n   return (\n     &lt;div>\n</span><span class=\"token inserted-sign inserted\">+      &lt;TodoProvider>\n</span><span class=\"token unchanged\">         &lt;TodoContainer />\n</span><span class=\"token inserted-sign inserted\">+      &lt;/TodoProvider>\n</span><span class=\"token unchanged\">     &lt;/div>\n   );\n };</span></code></pre></div>\n<p>Add <code class=\"language-text\">useContext()</code> hook with <code class=\"language-text\">TodoContext</code> parameter into <code class=\"language-text\">&lt;TodoList&gt;</code>. This will allow us to access context from component. Think of it like <code class=\"language-text\">connect()</code> function of Redux.</p>\n<div class=\"gatsby-highlight\" data-language=\"diff\"><pre class=\"language-diff\"><code class=\"language-diff\"><span class=\"token unchanged\"> export const TodoContainer = () => {\n</span><span class=\"token inserted-sign inserted\">+  const { todos, loadTodos } = useContext(TodoContext);\n</span><span class=\"token unchanged\"> \n   return (\n     &lt;div>\n       &lt;h1>Todos&lt;/h1>\n</span><span class=\"token deleted-sign deleted\">-      &lt;TodoList />\n</span><span class=\"token inserted-sign inserted\">+      &lt;TodoList todos={todos} loadTodos={loadTodos} />\n</span><span class=\"token unchanged\">     &lt;/div>\n   );\n };</span></code></pre></div>\n<p>Now to solve compile error, create <code class=\"language-text\">reducers/TodosReducer.js</code> and add following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">TodosReducer</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">state<span class=\"token punctuation\">,</span> action</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> state<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">default</span> TodosReducer<span class=\"token punctuation\">;</span></code></pre></div>\n<p>After that if we rerun E2E tests again you would see that we don't get any application errors now, instead we get \"First Todo\" is never shown error again. However we made some progress, <code class=\"language-text\">&lt;TodoList/&gt;</code> component\nnow dispatches <code class=\"language-text\">loadTodos</code> action, and lists received <code class=\"language-text\">todos</code> from provider. </p>\n<p>Now let's start defining <code class=\"language-text\">TodosReducer</code> behavior with unit test. Create <code class=\"language-text\">reducers/__tests__/TodoReducer.spec.jsx</code> and add following content:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\"><span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'TodosReducer'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">describe</span><span class=\"token punctuation\">(</span><span class=\"token string\">'loadTodos action'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    it<span class=\"token punctuation\">.</span><span class=\"token function\">todo</span><span class=\"token punctuation\">(</span><span class=\"token string\">'should store the todos'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Here we are expecting that TodosReducer will handle an action called  loadTodos and will store todos data as a result of that action.</p>\n<ul>\n<li>TIME TO CREATE BASIC REDUCER </li>\n<li>RUN E2E test and see different error (First todo not in dom) </li>\n<li>CREATE UNIT TEST FOR TodoReducer (loadTodos - Need to mock API)</li>\n<li>SHOW UNIT TEST ERROR</li>\n<li>IMPLEMENT LOAD TODOS ACTION AND REDUCER.</li>\n<li>UNIT TEST PASSED</li>\n<li>BACK TO E2E - FAILS WITH DIFFERENT ERROR</li>\n<li>IMPLEMENT API CLIENT</li>\n<li>\n<h2>FIRST FEATURE SHOULD BE DONE</h2>\n</li>\n</ul>\n<p>Outline</p>\n<ul>\n<li>Step down to unit test </li>\n<li>Create TodoList comp. Write tests for it with loadTodos method. </li>\n<li><strong>USE it.todo to show creating tests as todo</strong> </li>\n<li>\n<p>Explain why we create HOC for TodoContainer</p>\n<ul>\n<li>Write unit test for TodoProvider </li>\n<li>Create basic TodoContext (empty)</li>\n<li>Create TodoProvider only to provide todos</li>\n<li>Create TodoReducer (empty)</li>\n<li>Rerun E2E tests and show error</li>\n<li>Add empty loadTodos func.</li>\n<li>Show E2E error (Todo not visible error)</li>\n</ul>\n</li>\n<li>\n<p>Implement actual logic and make tests green </p>\n<ul>\n<li>Implement component logic</li>\n<li>Implement Context and store</li>\n<li>Implement client API</li>\n</ul>\n</li>\n<li>Refactor if needed</li>\n<li><strong>Might goood place to start Pt-2</strong></li>\n<li>Describe second feature: Adding Todos,</li>\n<li>Write E2E test that describes Adding Todo.</li>\n<li>Create minimal component (TodoCreateForm)</li>\n<li>Step down to unit tests and describe behavior</li>\n<li>Implement actual logic till making tests green.</li>\n<li>Conclusion &#x26; takeaways</li>\n</ul>","frontmatter":{"date":"2020-06-24T17:12:33.962Z","formattedDate":"June 24, 2020","path":"/testing-react-part-1","title":"Test-Driven Development with React - Part 1","tags":["React","TDD","Jest","React Testing Library"]}}},"pageContext":{}},"staticQueryHashes":["1132682437","63159454"]}